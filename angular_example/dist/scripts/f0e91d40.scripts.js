"use strict";app.controller("headCtrl",function(a,b){a.isActive=function(a){return a===b.path()}}),app.controller("MainCtrl",function(a,b,c){c.formId=!1}),app.controller("LoginController",function(){}),app.factory("RequestFactory",function(a,b){var c="frp_awc_survey",d=b.baseUrl,e=d.split(":").length;e>1&&!isNaN(d.split(":")[e-1])&&(d=d.split(":").slice(0,e-1).join(":")+"\\:"+d.split(":")[e-1]);var f=d+"/:userId/forms/:formId/api",g=a(f,{userId:b.userId,formId:c},{query:{method:"JSONP",isArray:!0,params:{callback:"JSON_CALLBACK"}}});return g}),app.factory("YukonWaterRequestFactory",function(a,b){var c="Logbook_wqm",d=b.baseUrl,e=d.split(":").length;e>1&&!isNaN(d.split(":")[e-1])&&(d=d.split(":").slice(0,e-1).join(":")+"\\:"+d.split(":")[e-1]);var f=d+"/:userId/forms/:formId/api",g=a(f,{userId:b.userId,formId:c},{query:{method:"JSONP",isArray:!0,params:{callback:"JSON_CALLBACK"}}});return g}),app.factory("FormRequestFactory",function(a,b){var c="frp_awc_survey",d=b.baseUrl,e=d.split(":").length;e>0&&!isNaN(d.split(":")[e-1])&&(d=d.split(":").slice(0,e-1).join(":")+"\\:"+d.split(":")[e-1]);var f=d+"/:userId/forms/:formId/form.json",g=a(f,{userId:b.userId,formId:c},{query:{method:"JSONP",isArray:!1,params:{callback:"JSON_CALLBACK"}}});return g}),app.factory("YukonWaterFormRequestFactory",function(a,b){var c="Logbook_wqm",d=b.baseUrl,e=d.split(":").length;e>0&&!isNaN(d.split(":")[e-1])&&(d=d.split(":").slice(0,e-1).join(":")+"\\:"+d.split(":")[e-1]);var f=d+"/:userId/forms/:formId/form.json",g=a(f,{userId:b.userId,formId:c},{query:{method:"JSONP",isArray:!1,params:{callback:"JSON_CALLBACK"}}});return g}),app.controller("PermitsCtrl",function(a,b,c,d,e,f){f.formId="frp_awc_survey",a.form_name=f.formId,a.permits=b.query(),a.permitInfo=function(b){for(var c,d={},e=[],f=0,g=a.permits.length;g>f;++f)c=a.permits[f][b],d.hasOwnProperty(c)||(e.push(c),d[c]=1);return e};var g=d.permitId||a.permits[0];a.permitId=g,a.selectObs=function(b){f.focusObsId=b;var c=a.markers[b];c&&(a.center.lat=c.lat,a.center.lng=c.lng,a.center.zoom=8)},a.markerInfo=function(a){var b="";return a.hasOwnProperty("_id")&&(b=b+"Observation: "+a._id+"<br/>"),a.hasOwnProperty("general/obs_nm")&&(b=b+a["general/obs_nm"]+"<br/>"),a.hasOwnProperty("general/wtr_nm")&&(b=b+a["general/wtr_nm"]+"<br/>"),a.hasOwnProperty("general/obs_date")&&(b+=a["general/obs_date"]),b},a.observations=b.query({query:'{"general/perm_num": "'+g+'"}'},function(b){for(var c=b.length-1;c>=0;c--){var d,e,f=b[c];void 0!=f["frp/obs_loc"]?(d=parseFloat(f["frp/obs_loc"].split(" ")[0]),e=parseFloat(f["frp/obs_loc"].split(" ")[1])):void 0!=f["frp/obs_lat"]&&void 0!=f["frp/obs_lon"]?(d=parseFloat(f["frp/obs_lat"]),e=parseFloat(f["frp/obs_lon"])):void 0!=f["awc/wtr_st"]?(d=parseFloat(f["awc/wtr_st"].split(" ")[0]),e=parseFloat(f["awc/wtr_st"].split(" ")[1])):void 0!=f["awc/wtr_end"]&&(d=parseFloat(f["awc/wtr_end"].split(" ")[0]),e=parseFloat(f["awc/wtr_end"].split(" ")[1])),void 0!=d&&void 0!=e&&(a.markers[f._id]={lat:d,lng:e,message:a.markerInfo(f),focus:!1,draggable:!1})}}),a.permits=b.query({},function(b){a.permit_attrs={},a.permit_attr_list=[];for(var c=0;c<b.length;c++)if(b[c]["general/perm_num"]==g){a.permit_attrs=b[c];for(var d in a.permit_attrs)a.permit_attrs.hasOwnProperty(d)&&a.permit_attr_list.push([d,a.permit_attrs[d]]);break}}),a.form=c.query(),a.center={lat:60.095,lng:-153.823,zoom:3},a.markers={},a.tiles={url:"http://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{opacity:.9,attribution:"Sources: National Geographic, Esri, DeLorme, NAVTEQ, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, iPC",detectRetina:!0,reuseTiles:!0}},a.frpExport={},a.frpSubmit=function(){var b=a.frpExport;b.permit=a.permitId;var c="";for(var d in b)""!==c&&(c+="&"),c+=d+"="+b[d];var e=f.baseUrl+"/"+f.userId+"/forms/"+f.formId+"/frp.xls?"+c;window.location.href=e},a.awcExport={},a.awcObservations=[],a.awcSubmit=function(){var b=a.awcExport;b.permit=a.permitId;var c="";for(var d in b)""!==c&&(c+="&"),c+=d+"="+b[d];for(var e,g=[],h=a.awcObservations.length-1;h>=0;h--)e=a.awcObservations[h],g.push(e._uuid);c+="&observations="+g.join(",");var i=f.baseUrl+"/"+f.userId+"/forms/"+f.formId+"/awc.pdf?"+c;window.location.href=i},a.imgUrl="",a.readify=function(b){for(var c={id:b._id},d=0;d<a.form.children.length;d++){for(var e={},f=0;f<a.form.children[d].children.length;f++){var g=a.form.children[d].name+"/"+a.form.children[d].children[f].name;b.hasOwnProperty(g)&&(e[a.form.children[d].children[f].name]={label:a.form.children[d].children[f].label,value:b[g]})}c[a.form.children[d].name]={label:a.form.children[d].label,value:e}}return c},a.observation_label=function(a){return a["general/obs_date"]+" - "+a["general/wtr_nm"]+" - "+a["general/sps_name"]},a.getImgUrl=function(a){return"/media/"+f.userId+"/attachments/"+a["general/pics"]},$(document).on("click mouseover",'[rel="tooltip"]',function(a){$(a.target).tooltip("show")})}),app.controller("YukonWaterCtrl",function(a,b,c,d,e,f){a.form_name="Logbook_wqm",f.formId="Logbook_wqm",a.sites=b.query(),a.siteInfo=function(b){for(var c,d={},e=[],f=0,g=a.sites.length;g>f;++f)c=a.sites[f][b],d.hasOwnProperty(c)||(e.push(c),d[c]=1);return e};var g=d.siteId||a.sites[0];a.siteId=g,a.selectObs=function(b){f.focusObsId=b;var c=a.markers[b];c&&(a.center.lat=c.lat,a.center.lng=c.lng,a.center.zoom=8)},a.markerInfo=function(a){var b="";if(a.hasOwnProperty("general/wtr_bdy")&&(b=b+a["general/wtr_bdy"]+"<br/>"),a.hasOwnProperty("general/date")&&(b+=a["general/date"],a.hasOwnProperty("general/st_time")&&(b=b+" "+a["general/st_time"]),b+="<br/>"),a.hasOwnProperty("general/tech_name")||a.hasOwnProperty("field/ph")||a.hasOwnProperty("field/dssvld_o_perc")||a.hasOwnProperty("field/dssvld_o")||a.hasOwnProperty("field/conduct")||a.hasOwnProperty("field/air_temp")||a.hasOwnProperty("field/wtr_temp")){var c=!0;b+="<table>"}else var c=!1;return a.hasOwnProperty("general/tech_name")&&(b=b+"<tr><td><b>Technicians</b>:</td><td>"+a["general/tech_name"]+"</td></tr>"),a.hasOwnProperty("field/ph")&&(b=b+"<tr><td><b>pH</b>:</td><td>"+a["field/ph"]+"</td></tr>"),(a.hasOwnProperty("field/dssvld_o_perc")||a.hasOwnProperty("field/dssvld_o"))&&(b+="<tr><td><b>Dissolved <br/>0<sub>2</sub></b>:</td><td>",a.hasOwnProperty("field/dssvld_o_perc")&&(b=b+a["field/dssvld_o_perc"]+"%",a.hasOwnProperty("field/dssvld_o")&&(b+=" / ")),a.hasOwnProperty("field/dssvld_o")&&(b=b+a["field/dssvld_o"]+"mg/L<br/>"),b+="</td></tr>"),a.hasOwnProperty("field/conduct")&&(b=b+"<tr><td><b>Conductivity</b>:</td><td>"+a["field/conduct"]+"</td></tr>"),a.hasOwnProperty("field/air_temp")&&(b=b+"<tr><td><b>Air Temp</b>:</td><td>"+a["field/air_temp"]+"</td></tr>"),a.hasOwnProperty("field/wtr_temp")&&(b=b+"<tr><td><b>Water Temp</b>:</td><td>"+a["field/wtr_temp"]+"</td></tr>"),c&&(b+="</table>"),b},a.observations=b.query({query:'{"general/site_id": "'+g+'"}'},function(b){for(var c=b.length-1;c>=0;c--){var d,e,f=b[c];void 0!=f["field/gps_loc"]&&(d=parseFloat(f["field/gps_loc"].split(" ")[0]),e=parseFloat(f["field/gps_loc"].split(" ")[1])),void 0!=d&&void 0!=e&&(a.markers[f._id]={lat:d,lng:e,message:a.markerInfo(f),focus:!1,draggable:!1})}}),a.sites=b.query({},function(b){a.site_attrs={},a.site_attr_list=[];for(var c=0;c<b.length;c++)if(b[c]["general/site_id"]==g){a.site_attrs=b[c];for(var d in a.site_attrs)a.site_attrs.hasOwnProperty(d)&&a.site_attr_list.push([d,a.site_attrs[d]]);break}}),a.form=c.query(),a.center={lat:60.095,lng:-153.823,zoom:3},a.markers={},a.tiles={url:"http://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{opacity:.9,attribution:"Sources: National Geographic, Esri, DeLorme, NAVTEQ, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, iPC",detectRetina:!0,reuseTiles:!0}},a.yukonExport={},a.yukonCustomSubmit=function(){var b=a.yukonExport;b.site=a.siteId;var c="";for(var d in b)""!==c&&(c+="&"),c+=d+"="+b[d];var e=f.baseUrl+"/"+f.userId+"/forms/"+f.formId+"/yukon.xls?"+c;window.location.href=e},a.observation_label=function(a){return a["site/date"]+" - "+a["site/site_name"]+" - "+a["site/loc_city"]+", "+["site/loc_state"]},$(document).on("click mouseover",'[rel="tooltip"]',function(a){$(a.target).tooltip("show")})}),app.controller("helpCtrl",function(a,b,c,d,e,f){f.formId=null}),angular.module("angularjsGruntExampleApp").controller("ModalCtrl",["$scope","RequestFactory","$modal","$log","$rootScope",function(a,b,c,d,e){a.readify=function(b){for(var c={id:b._id,form_name:b._xform_id_string},d=0;d<a.form.children.length;d++){for(var e={},f=0;f<a.form.children[d].children.length;f++){var g=a.form.children[d].name+"/"+a.form.children[d].children[f].name;b.hasOwnProperty(g)&&(e[a.form.children[d].children[f].name]={label:a.form.children[d].children[f].label,value:b[g]})}c[a.form.children[d].name]={label:a.form.children[d].label,value:e}}return c},a.setFocusObservation=function(c){b.query({query:'{"_id": "'+e.focusObsId+'"}'},function(b){return e.focusObservation=a.readify(b[0]),a.open(c),!0})},a.open=function(b){"survey"==b?c.open({templateUrl:"surveyModalContent.html",controller:"ModalInstanceCtrl",resolve:{items:function(){return a.items}}}):"export-frp"==b?c.open({templateUrl:"exportFrpModalContent.html",controller:"ModalInstanceCtrl",resolve:{items:function(){return a.items}}}):"export-awc"==b?c.open({templateUrl:"exportAwcModalContent.html",controller:"ModalInstanceCtrl",resolve:{items:function(){return a.items}}}):"photo"==b?c.open({templateUrl:"photoModalContent.html",controller:"ModalInstanceCtrl",resolve:{items:function(){return a.items}}}):"details"==b?c.open({templateUrl:"detailsModalContent.html",controller:"ModalInstanceCtrl",resolve:{items:function(){return a.items}}}):"delete"==b&&c.open({templateUrl:"deleteModalContent.html",controller:"ModalInstanceCtrl",resolve:{items:function(){return a.items}}})}}]),angular.module("angularjsGruntExampleApp").controller("ModalInstanceCtrl",["$scope","$modalInstance","items","$rootScope",function(a,b){a.close=function(){b.dismiss()},a.getCookie=function(a){var b=null;if(document.cookie&&""!=document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b},a.csrftoken=a.getCookie("csrftoken"),a.deleteData=function(b,c,d){var e="/"+c+"/forms/"+d+"/delete_data";$.post(e,{id:b,csrfmiddlewaretoken:a.csrftoken}).success(function(){window.location.href="/app/#/permits"}).error(function(){alert("Delete failed.")}),b=null}}]),angular.module("angularjsGruntExampleApp").controller("YukonModalCtrl",["$scope","YukonWaterRequestFactory","$modal","$log","$rootScope",function(a,b,c,d,e){a.readify=function(b){for(var c={id:b._id,form_name:b._xform_id_string},d=0;d<a.form.children.length;d++){for(var e={},f=0;f<a.form.children[d].children.length;f++){var g=a.form.children[d].name+"/"+a.form.children[d].children[f].name;b.hasOwnProperty(g)&&(e[a.form.children[d].children[f].name]={label:a.form.children[d].children[f].label,value:b[g]})}c[a.form.children[d].name]={label:a.form.children[d].label,value:e}}return c},a.setFocusObservation=function(c){b.query({query:'{"_id": "'+e.focusObsId+'"}'},function(b){return e.focusObservation=a.readify(b[0]),a.open(c),!0})},a.open=function(b){"details"==b?c.open({templateUrl:"yukonDetailsModalContent.html",controller:"ModalInstanceCtrl",resolve:{items:function(){return a.items}}}):"delete"==b?c.open({templateUrl:"yukonDeleteModalContent.html",controller:"ModalInstanceCtrl",resolve:{items:function(){return a.items}}}):"export-yukon"==b&&c.open({templateUrl:"exportYukonModalContent.html",controller:"ModalInstanceCtrl",resolve:{items:function(){return a.items}}})}}]),angular.module("angularjsGruntExampleApp").controller("ModalInstanceCtrl",["$scope","$modalInstance","items","$rootScope",function(a,b){a.close=function(){b.dismiss()},a.getCookie=function(a){var b=null;if(document.cookie&&""!=document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b},a.csrftoken=a.getCookie("csrftoken"),a.deleteData=function(b,c,d){var e="/"+c+"/forms/"+d+"/delete_data";$.post(e,{id:b,csrfmiddlewaretoken:a.csrftoken}).success(function(){window.location.href="/app/#/yukon_water"}).error(function(){alert("Delete failed.")}),b=null}}]);